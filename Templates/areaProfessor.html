<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='areaProfessor.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Dashboard do Professor</title>
</head>
<body>
    <header class="header">
        <h1>Bem-vindo, {{ professor.nome }}</h1>
        <div class="header-buttons">
            {% if admin %}
                <a href="{{ url_for('admin.admin_dashboard') }}" class="button">Área Administrativa</a>
            {% endif %}
            <a href="{{ url_for('logout.logout') }}" class="button">Logout</a>
        </div>
    </header>

    <h2>Enviar Treinamento para Aluno</h2>
    <form action="{{ url_for('area_professor.area_professor') }}" method="POST">
        {{ form_treinamento.hidden_tag() }}
        <label for="id_aluno">{{ form_treinamento.id_aluno.label }}</label>
        {{ form_treinamento.id_aluno }}
        <label for="treino">{{ form_treinamento.treino.label }}</label>
        {{ form_treinamento.treino }}
        <button type="submit">Enviar Treinamento</button>
    </form>

    <h2>Registrar Progresso do Aluno</h2>
    <form action="{{ url_for('area_professor.area_professor') }}" method="POST">
        {{ form_progresso.hidden_tag() }}
        <label for="id_aluno">{{ form_progresso.id_aluno.label }}</label>
        {{ form_progresso.id_aluno(id="selectAluno", onchange="atualizarGrafico(this.value)") }}
        <label for="peso">{{ form_progresso.peso.label }}</label>
        {{ form_progresso.peso }}
        <label for="altura">{{ form_progresso.altura.label }}</label>
        {{ form_progresso.altura }}
        <label for="bracoE">{{ form_progresso.bracoE.label }}</label>
        {{ form_progresso.bracoE }}
        <label for="bracoD">{{ form_progresso.bracoD.label }}</label>
        {{ form_progresso.bracoD }}
        <label for="panturrilhaE">{{ form_progresso.panturrilhaE.label }}</label>
        {{ form_progresso.panturrilhaE }}
        <label for="panturrilhaD">{{ form_progresso.panturrilhaD.label }}</label>
        {{ form_progresso.panturrilhaD }}
        <label for="torax">{{ form_progresso.torax.label }}</label>
        {{ form_progresso.torax }}
        <label for="cintura">{{ form_progresso.cintura.label }}</label>
        {{ form_progresso.cintura }}
        <label for="coxaE">{{ form_progresso.coxaE.label }}</label>
        {{ form_progresso.coxaE }}
        <label for="coxaD">{{ form_progresso.coxaD.label }}</label>
        {{ form_progresso.coxaD }}
        <label for="observacoes">{{ form_progresso.observacoes.label }}</label>
        {{ form_progresso.observacoes }}
        <button type="submit">Registrar Progresso</button>
    </form>

    <h2>Gráfico de Progresso do Aluno</h2>
    <div>
        <h3>Progresso do Aluno</h3>
        <canvas id="graficoProgresso"></canvas>
    </div>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <ul>
                {% for category, message in messages %}
                    <li class="{{ category }}">{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}
    
    <h2>Estatísticas de Progresso dos Alunos</h2>
    <table>
        <thead>
            <tr>
                <th>Aluno</th>
                <th>Progresso</th>
            </tr>
        </thead>
        <tbody>
            {% for aluno in alunos %}
                <tr>
                    <td>{{ aluno.nome }}</td>
                    <td>
                        {% if aluno.id_aluno in progresso_alunos and progresso_alunos[aluno.id_aluno] %}
                            {% for p in progresso_alunos[aluno.id_aluno] %}
                                <p>{{ p }}</p>
                            {% endfor %}
                        {% else %}
                            <p>Sem progresso registrado</p>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <h2>Gráfico de Resultados Antes e Depois</h2>
    <div>
        <h3>Progresso do Aluno</h3>
        <canvas id="graficoProgresso"></canvas>
    </div>

    <script>
        const ctx = document.getElementById('graficoProgresso').getContext('2d');
        let graficoProgresso = null;

        // Função para criar ou atualizar o gráfico
        function criarOuAtualizarGrafico(labels, datasets) {
            if (graficoProgresso) {
                graficoProgresso.destroy(); // Destroi o gráfico existente
            }

            graficoProgresso = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Progresso do Aluno'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Função para atualizar o gráfico ao selecionar um aluno
        function atualizarGrafico(idAluno) {
            fetch(`/area/professor/${idAluno}`) // Faz uma requisição para obter os dados do aluno
                .then(response => response.json())
                .then(data => {
                    criarOuAtualizarGrafico(data.labels, data.datasets);
                })
                .catch(error => console.error('Erro ao atualizar o gráfico:', error));
        }
    </script>
</body>
</html>
